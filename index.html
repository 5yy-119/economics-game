<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The World‚Äôs Most ‚Äì Economics Flag Game</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      color: #222;
    }

    .container {
      max-width: 1000px;
      width: 100%;
      padding: 20px;
    }

    h1, h2, h3 {
      text-align: center;
    }

    h1 {
      margin-bottom: 10px;
    }

    .subtitle {
      text-align: center;
      margin-bottom: 20px;
      color: #e5e7eb;
    }

    .btn-row {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 15px 0 25px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 26px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 18px;
      background: #f97316;
      color: white;
      box-shadow: 0 4px 12px rgba(248, 153, 57, 0.4);
      transition: transform 0.07s ease, box-shadow 0.07s ease, background 0.1s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(248, 153, 57, 0.55);
      background: #ea580c;
    }

    button:active {
      transform: translateY(0px);
      box-shadow: 0 2px 8px rgba(248, 153, 57, 0.65);
    }

    .concepts {
      background: #111827;
      border-radius: 16px;
      padding: 16px 20px;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.8);
      margin-bottom: 18px;
      color: #e5e7eb;
    }

    .concepts h3 {
      margin-top: 0;
      text-align: left;
    }

    .concepts ul {
      margin: 8px 0 0 18px;
      padding: 0;
    }

    .concepts li {
      margin-bottom: 4px;
      font-size: 14px;
    }

    #intro-screen {
      display: block;
    }

    #game-screen {
      display: none;
    }

    .hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 15px;
      color: #f9fafb;
    }

    .question-text {
      font-weight: 600;
      margin-bottom: 10px;
      min-height: 48px;
      color: #f9fafb;
    }

    #game-area-wrapper {
      background: radial-gradient(circle at top, #22c55e33, #000);
      border-radius: 18px;
      padding: 10px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.85);
      margin-bottom: 8px;
    }

    #game-area {
      position: relative;
      height: 540px; /* 1.5x previous 360 */
      border-radius: 16px;
      background: #020617;
      background-image: url("images/background.jpeg"); /* <--- your background */
      background-size: cover;
      background-position: center;
      overflow: hidden;
    }

    .flag {
      position: absolute;
      top: -96px;
      width: 96px;   /* larger flags */
      height: 96px;
      pointer-events: none;
      user-select: none;
    }

    .flag-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 999px;
    }

    #basket {
      position: absolute;
      bottom: 18px;
      width: 120px;  /* 1.5x previous 80 */
      height: 60px;  /* 1.5x previous 40 */
      border-radius: 999px;
      background: #f97316;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      color: #fff;
      box-shadow: 0 4px 12px rgba(124, 45, 18, 0.7);
      border: 3px solid rgba(255, 255, 255, 0.8);
    }

    #options-legend {
      margin-top: 10px;
      font-size: 14px;
      background: #020617;
      color: #e5e7eb;
      border-radius: 12px;
      padding: 8px 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    #options-legend span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    #options-legend img {
      width: 22px;
      height: 22px;
      border-radius: 999px;
    }

    #message {
      margin-top: 10px;
      min-height: 34px;
      font-size: 15px;
    }

    .correct {
      color: #4ade80;
    }

    .wrong {
      color: #fb7185;
    }

    #result-screen {
      margin-top: 16px;
      padding: 12px 14px;
      border-radius: 12px;
      background: #022c22;
      border: 1px solid #22c55e;
      display: none;
      font-size: 15px;
      color: #f9fafb;
    }

    #result-title {
      display: block;
      margin-bottom: 6px;
      font-size: 22px;
      font-weight: 800;
      background-image: linear-gradient(90deg, #f97316, #facc15, #22c55e, #38bdf8, #a855f7);
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 0 0 12px rgba(248, 250, 252, 0.5);
    }

    .gift {
      margin-top: 6px;
      font-weight: 600;
      color: #bbf7d0;
    }

    .controls-hint {
      font-size: 12px;
      text-align: center;
      margin-top: 6px;
      color: #9ca3af;
    }

    .play-big {
      font-size: 28px;
      padding: 18px 40px;
    }

    @media (max-width: 700px) {
      .container {
        padding: 12px;
      }
      #game-area {
        height: 480px;
      }
      .play-big {
        font-size: 24px;
        padding: 16px 32px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 style="color:#facc15;">THE WORLD‚ÄôS MOST</h1>
    <p class="subtitle">
      Move the basket to catch the correct country flag before it falls!
    </p>

    <!-- INTRO / CONCEPTS SCREEN -->
    <div id="intro-screen">
      <div class="concepts">
        <h3>Key Economic Concepts in This Game</h3>
        <ul>
          <li><strong>GDP (Gross Domestic Product)</strong>: Total value of goods and services produced in a country.</li>
          <li><strong>GDP per capita</strong>: GDP divided by population ‚Äì average income or living standard.</li>
          <li><strong>Income inequality (Gini coefficient)</strong>: How unevenly income is distributed.</li>
          <li><strong>Cost of living</strong>: How expensive it is to maintain a basic lifestyle.</li>
          <li><strong>Inflation</strong>: How quickly overall prices of goods and services are rising.</li>
          <li><strong>Unemployment rate</strong>: Share of workers who are jobless but actively looking for work.</li>
          <li><strong>Trade surplus</strong>: Exports &gt; imports.</li>
          <li><strong>FDI (Foreign Direct Investment)</strong>: Investment from foreign companies into a country.</li>
          <li><strong>Minimum wage</strong>: The lowest legal wage employers can pay workers.</li>
          <li><strong>Big Mac Index</strong>: Compares Big Mac prices across countries to show purchasing power.</li>
        </ul>
      </div>

      <h3 style="color:#e5e7eb;">Choose Your Question Set</h3>
      <p style="text-align:center; font-size:14px; color:#d1d5db;">
        Each set has 6 questions. You have <strong>3 minutes</strong> to finish.<br/>
        Get <strong>3 or more correct</strong> to win a small gift üéÅ (in real life at the booth)!
      </p>

      <div class="btn-row">
        <button id="start-set-1" class="play-big">PLAY ‚Äì Set 1</button>
        <button id="start-set-2" class="play-big">PLAY ‚Äì Set 2</button>
      </div>

      <p class="controls-hint">
        Controls: Drag with your finger (iPad) or mouse on the game area to move the basket.
      </p>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen">
      <div class="hud">
        <div id="question-counter">Question 1 / 6</div>
        <div id="timer">Time left: 03:00</div>
        <div id="score-display">Correct: 0</div>
      </div>
      <div class="question-text" id="question-text"></div>

      <div id="game-area-wrapper">
        <div id="game-area">
          <div id="basket">üß∫</div>
        </div>
      </div>

      <div id="options-legend"></div>
      <div id="message"></div>

      <div id="result-screen">
        <span id="result-title">CONGRATULATIONS!!! üéâ</span>
        <span id="result-detail"></span>
        <div class="gift" id="gift-message"></div>
        <div class="btn-row" style="margin-top:10px; justify-content:flex-start;">
          <button id="play-again-set1">Play Set 1 Again</button>
          <button id="play-again-set2">Play Set 2 Again</button>
          <button id="back-to-intro">Back to Concepts</button>
        </div>
      </div>

      <p class="controls-hint">
        Tip: Catch only the correct flag. One catch = one answer!
      </p>
    </div>
  </div>

  <!-- Optional: background music (upload background-music.mp3 into /music and update src) -->
  <!--
  <audio id="bg-music" src="music/background-music.mp3" loop></audio>
  -->

  <script>
    // ---------- QUESTION DATA ----------
    // Image files are assumed to live in /images with these names.
    function img(name) {
      return "images/" + name; // helper
    }

    const SET1_QUESTIONS = [
      {
        id: 1,
        text: "Which country has the largest GDP among the following?",
        options: [
          { country: "Switzerland", image: img("switzerland.png") },
          { country: "Canada", image: img("canada.png") },
          { country: "Japan", image: img("japan.png") },
          { country: "China", image: img("china.png") } // correct
        ],
        correctIndex: 3,
        explanation: "China has the largest economy by total GDP among these countries."
      },
      {
        id: 3,
        text: "Which place is known for very high income inequality (large gap between rich and poor)?",
        options: [
          { country: "Switzerland", image: img("switzerland.png") },
          { country: "Indonesia", image: img("indonesia.png") },
          { country: "South Korea", image: img("south-korea.png") },
          { country: "Hong Kong", image: img("hong-kong.png") } // correct
        ],
        correctIndex: 3,
        explanation: "Hong Kong‚Äôs income inequality is among the highest in advanced economies."
      },
      {
        id: 5,
        text: "Which country among the following has one of the highest national debts-to-GDP ratios?",
        options: [
          { country: "China", image: img("china.png") },
          { country: "Canada", image: img("canada.png") },
          { country: "Japan", image: img("japan.png") }, // correct
          { country: "United Kingdom", image: img("united-kingdom.png") }
        ],
        correctIndex: 2,
        explanation: "Japan‚Äôs public debt is more than twice its GDP, extremely high by international standards."
      },
      {
        id: 7,
        text: "Which of these countries is famous for very high cost of living?",
        options: [
          { country: "Indonesia", image: img("indonesia.png") },
          { country: "Philippines", image: img("philippines.png") },
          { country: "Canada", image: img("canada.png") },
          { country: "Switzerland", image: img("switzerland.png") } // correct
        ],
        correctIndex: 3,
        explanation: "Switzerland is one of the most expensive countries in the world to live in."
      },
      {
        id: 9,
        text: "Which country‚Äôs currency is usually very strong and often looks overvalued in the Big Mac Index?",
        options: [
          { country: "Japan", image: img("japan.png") },
          { country: "China", image: img("china.png") },
          { country: "South Korea", image: img("south-korea.png") },
          { country: "Switzerland", image: img("switzerland.png") } // correct
        ],
        correctIndex: 3,
        explanation: "Switzerland often appears very expensive in the Big Mac Index, reflecting a strong currency."
      },
      {
        id: 11,
        text: "Which country is a major high-income economy with many global companies and strong exports of cars and electronics?",
        options: [
          { country: "Philippines", image: img("philippines.png") },
          { country: "Indonesia", image: img("indonesia.png") },
          { country: "South Korea", image: img("south-korea.png") }, // correct
          { country: "Canada", image: img("canada.png") }
        ],
        correctIndex: 2,
        explanation: "South Korea is a rich, industrialised economy with famous global brands and strong exports."
      }
    ];

    const SET2_QUESTIONS = [
      {
        id: 2,
        text: "Which country has one of the highest GDP per capita among the options?",
        options: [
          { country: "Japan", image: img("japan.png") },
          { country: "Switzerland", image: img("switzerland.png") }, // correct
          { country: "Canada", image: img("canada.png") },
          { country: "Philippines", image: img("philippines.png") }
        ],
        correctIndex: 1,
        explanation: "Switzerland is a very high-income country with one of the highest GDP per capita figures."
      },
      {
        id: 4,
        text: "Which economy is known as a major international financial centre in Asia?",
        options: [
          { country: "Indonesia", image: img("indonesia.png") },
          { country: "Hong Kong", image: img("hong-kong.png") }, // correct
          { country: "Philippines", image: img("philippines.png") },
          { country: "Canada", image: img("canada.png") }
        ],
        correctIndex: 1,
        explanation: "Hong Kong is a key global financial centre with many banks and financial institutions."
      },
      {
        id: 6,
        text: "Which country is well known for strong exports of technology products and cars?",
        options: [
          { country: "South Korea", image: img("south-korea.png") }, // correct
          { country: "Philippines", image: img("philippines.png") },
          { country: "Indonesia", image: img("indonesia.png") },
          { country: "United Kingdom", image: img("united-kingdom.png") }
        ],
        correctIndex: 0,
        explanation: "South Korea exports many electronics and cars (for example Samsung, Hyundai, Kia)."
      },
      {
        id: 8,
        text: "Which country is the world‚Äôs largest exporter of goods among these choices?",
        options: [
          { country: "China", image: img("china.png") }, // correct
          { country: "Canada", image: img("canada.png") },
          { country: "Japan", image: img("japan.png") },
          { country: "Philippines", image: img("philippines.png") }
        ],
        correctIndex: 0,
        explanation: "China is the world‚Äôs largest exporter of goods, supplying products to many countries."
      },
      {
        id: 13,
        text: "Which country among these has the lowest minimum wage in HKD terms?",
        options: [
          { country: "Canada", image: img("canada.png") },
          { country: "United Kingdom", image: img("united-kingdom.png") },
          { country: "Philippines", image: img("philippines.png") }, // correct
          { country: "Japan", image: img("japan.png") }
        ],
        correctIndex: 2,
        explanation: "The Philippines generally has a much lower statutory minimum wage than the other countries listed."
      },
      {
        id: 16,
        text: "Which of these countries is part of the G7 group of advanced economies?",
        options: [
          { country: "Indonesia", image: img("indonesia.png") },
          { country: "Philippines", image: img("philippines.png") },
          { country: "Japan", image: img("japan.png") }, // correct
          { country: "South Korea", image: img("south-korea.png") }
        ],
        correctIndex: 2,
        explanation: "Japan is a member of the G7, a group of major advanced economies."
      }
    ];

    // ---------- GAME STATE ----------

    const introScreen = document.getElementById("intro-screen");
    const gameScreen = document.getElementById("game-screen");
    const questionTextEl = document.getElementById("question-text");
    const questionCounterEl = document.getElementById("question-counter");
    const timerEl = document.getElementById("timer");
    const scoreDisplayEl = document.getElementById("score-display");
    const gameArea = document.getElementById("game-area");
    const basket = document.getElementById("basket");
    const optionsLegendEl = document.getElementById("options-legend");
    const messageEl = document.getElementById("message");
    const resultScreen = document.getElementById("result-screen");
    const resultTitleEl = document.getElementById("result-title");
    const resultDetailEl = document.getElementById("result-detail");
    const giftMessageEl = document.getElementById("gift-message");
    const bgMusicEl = document.getElementById("bg-music"); // may be null if you didn't add audio

    let currentQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let timeLeft = 180; // seconds
    let timerInterval = null;
    let animationInterval = null;
    let fallingFlags = [];
    let questionActive = false;
    let basketX = 0;
    let audioCtx = null;
    let gameRunning = false;

    const FLAG_SIZE = 96;

    function resetGameState() {
      clearInterval(timerInterval);
      clearInterval(animationInterval);
      timerInterval = null;
      animationInterval = null;
      timeLeft = 180;
      currentIndex = 0;
      score = 0;
      fallingFlags = [];
      questionActive = false;
      messageEl.textContent = "";
      messageEl.className = "";
      optionsLegendEl.innerHTML = "";
      resultScreen.style.display = "none";
      updateTimerDisplay();
      updateScoreDisplay();
    }

    function startGame(setNumber) {
      if (gameRunning) return;
      gameRunning = true;

      resetGameState();
      currentQuestions = setNumber === 1 ? SET1_QUESTIONS : SET2_QUESTIONS;

      introScreen.style.display = "none";
      gameScreen.style.display = "block";

      setTimeout(() => {
        const areaWidth = gameArea.clientWidth;
        basketX = (areaWidth - basket.offsetWidth) / 2;
        updateBasketPosition();
      }, 0);

      if (bgMusicEl) {
        bgMusicEl.currentTime = 0;
        bgMusicEl.play().catch(() => {});
      }

      startTimer();
      loadQuestion();
    }

    function startTimer() {
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft < 0) timeLeft = 0;
        updateTimerDisplay();
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          endGame();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const minutes = String(Math.floor(timeLeft / 60)).padStart(2, "0");
      const seconds = String(timeLeft % 60).padStart(2, "0");
      timerEl.textContent = `Time left: ${minutes}:${seconds}`;
    }

    function updateScoreDisplay() {
      scoreDisplayEl.textContent = `Correct: ${score}`;
    }

    function clearFlags() {
      fallingFlags.forEach(f => {
        if (f.el && f.el.parentNode) f.el.parentNode.removeChild(f.el);
      });
      fallingFlags = [];
    }

    function loadQuestion() {
      clearInterval(animationInterval);
      animationInterval = null;
      clearFlags();
      messageEl.textContent = "";
      messageEl.className = "";
      optionsLegendEl.innerHTML = "";

      if (currentIndex >= currentQuestions.length || timeLeft <= 0) {
        endGame();
        return;
      }

      const q = currentQuestions[currentIndex];
      questionActive = true;

      questionCounterEl.textContent = `Question ${currentIndex + 1} / ${currentQuestions.length}`;
      questionTextEl.textContent = q.text;

      // options legend
      q.options.forEach(opt => {
        const span = document.createElement("span");
        const imgEl = document.createElement("img");
        imgEl.src = opt.image;
        imgEl.alt = opt.country;
        span.appendChild(imgEl);
        span.appendChild(document.createTextNode(" " + opt.country));
        optionsLegendEl.appendChild(span);
      });

      const areaWidth = gameArea.clientWidth;
      const areaHeight = gameArea.clientHeight;

      const usedX = [];

      q.options.forEach((opt, index) => {
        const el = document.createElement("img");
        el.className = "flag";
        el.src = opt.image;
        el.alt = opt.country;
        gameArea.appendChild(el);

        let x;
        let tries = 0;
        do {
          x = 20 + Math.random() * (areaWidth - FLAG_SIZE - 40);
          tries++;
        } while (usedX.some(px => Math.abs(px - x) < FLAG_SIZE * 1.4) && tries < 10);
        usedX.push(x);

        const speed = 1.0 + Math.random() * 1.0; // slightly slower

        el.style.left = x + "px";
        el.style.top = -FLAG_SIZE + "px";

        fallingFlags.push({
          el,
          x,
          y: -FLAG_SIZE,
          speed,
          isCorrect: index === q.correctIndex,
          option: opt
        });
      });

      animationInterval = setInterval(() => {
        updateFlags(areaHeight);
      }, 30);
    }

    function updateFlags(areaHeight) {
      if (!questionActive) return;

      const basketRect = basket.getBoundingClientRect();

      fallingFlags.forEach(flag => {
        flag.y += flag.speed;
        flag.el.style.top = flag.y + "px";

        const flagRect = flag.el.getBoundingClientRect();
        if (isIntersecting(basketRect, flagRect) && questionActive) {
          handleFlagCaught(flag);
        }
      });

      fallingFlags = fallingFlags.filter(flag => {
        if (flag.y > areaHeight + FLAG_SIZE) {
          if (flag.el && flag.el.parentNode) {
            flag.el.parentNode.removeChild(flag.el);
          }
          return false;
        }
        return true;
      });

      if (fallingFlags.length === 0 && questionActive) {
        questionActive = false;
        messageEl.textContent = "‚è± The flags disappeared for this question.";
        messageEl.className = "wrong";
        setTimeout(() => {
          currentIndex++;
          loadQuestion();
        }, 1800);
      }
    }

    function isIntersecting(rect1, rect2) {
      return !(
        rect1.right < rect2.left ||
        rect1.left > rect2.right ||
        rect1.bottom < rect2.top ||
        rect1.top > rect2.bottom
      );
    }

    function handleFlagCaught(flag) {
      if (!questionActive) return;
      questionActive = false;

      clearInterval(animationInterval);
      animationInterval = null;

      setTimeout(clearFlags, 200);

      const q = currentQuestions[currentIndex];
      const correctOption = q.options[q.correctIndex];

      if (flag.isCorrect) {
        score++;
        updateScoreDisplay();
        playTone(900, 0.18); // correct sound
        messageEl.textContent = "‚úÖ Correct! " + q.explanation;
        messageEl.className = "correct";
      } else {
        playTone(220, 0.22); // wrong sound
        messageEl.textContent =
          `‚ùå Not quite. The correct flag was ${correctOption.country}. ` + q.explanation;
        messageEl.className = "wrong";
      }

      setTimeout(() => {
        currentIndex++;
        loadQuestion();
      }, 2600); // a few more seconds to read
    }

    function endGame() {
      questionActive = false;
      gameRunning = false;
      clearInterval(animationInterval);
      animationInterval = null;
      clearFlags();

      if (bgMusicEl) {
        bgMusicEl.pause();
      }

      resultScreen.style.display = "block";
      resultTitleEl.textContent = score >= 3
        ? "üéâüéâ CONGRATULATIONS!!! üéâüéâ"
        : "Good effort! Keep going!";
      resultDetailEl.textContent = `You answered ${score} out of ${currentQuestions.length} questions correctly.`;

      if (score >= 3) {
        giftMessageEl.textContent = "You have won a small gift! üéÅ";
        playApplause();
      } else {
        giftMessageEl.textContent = "Try again ‚Äì get 3 or more correct to win a gift!";
      }
    }

    // ---------- BASKET MOVEMENT (mouse + touch) ----------

    function updateBasketPosition() {
      const areaWidth = gameArea.clientWidth;
      const maxX = areaWidth - basket.offsetWidth - 4;
      if (basketX < 4) basketX = 4;
      if (basketX > maxX) basketX = maxX;
      basket.style.left = basketX + "px";
    }

    function moveBasketToClientX(clientX) {
      const rect = gameArea.getBoundingClientRect();
      let x = clientX - rect.left - basket.offsetWidth / 2;
      basketX = x;
      updateBasketPosition();
    }

    // Pointer events (mouse + most modern touch)
    gameArea.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      moveBasketToClientX(e.clientX);
      gameArea.setPointerCapture(e.pointerId);
    });

    gameArea.addEventListener("pointermove", (e) => {
      if (e.buttons === 1) {
        e.preventDefault();
        moveBasketToClientX(e.clientX);
      }
    });

    gameArea.addEventListener("pointerup", (e) => {
      gameArea.releasePointerCapture(e.pointerId);
    });

    // Fallback for older iPads (touch events)
    function handleTouch(e) {
      if (!e.touches || e.touches.length === 0) return;
      const touch = e.touches[0];
      moveBasketToClientX(touch.clientX);
      e.preventDefault();
    }
    gameArea.addEventListener("touchstart", handleTouch, { passive: false });
    gameArea.addEventListener("touchmove", handleTouch, { passive: false });

    // Optional: still allow keyboard on desktop
    window.addEventListener("keydown", (e) => {
      const step = 32;
      if (e.key === "ArrowLeft" || e.key === "a" || e.key === "A") {
        basketX -= step;
        updateBasketPosition();
      } else if (e.key === "ArrowRight" || e.key === "d" || e.key === "D") {
        basketX += step;
        updateBasketPosition();
      }
    });

    // ---------- SOUND EFFECTS (simple, no files needed) ----------

    function ensureAudioCtx() {
      if (!audioCtx) {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        if (!AudioContext) return null;
        audioCtx = new AudioContext();
      }
      return audioCtx;
    }

    function playTone(freq, duration) {
      const ctx = ensureAudioCtx();
      if (!ctx) return;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "triangle";
      osc.frequency.setValueAtTime(freq, ctx.currentTime);
      gain.gain.setValueAtTime(0.25, ctx.currentTime);
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start();
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
      osc.stop(ctx.currentTime + duration + 0.02);
    }

    function playApplause() {
      // Simple ‚Äúapplause-like‚Äù sweep using noise & envelope
      const ctx = ensureAudioCtx();
      if (!ctx) return;
      const bufferSize = 2 * ctx.sampleRate;
      const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
      const output = buffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        output[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize); // fade out
      }
      const whiteNoise = ctx.createBufferSource();
      whiteNoise.buffer = buffer;
      const gain = ctx.createGain();
      gain.gain.setValueAtTime(0.5, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 1.4);
      whiteNoise.connect(gain);
      gain.connect(ctx.destination);
      whiteNoise.start();
    }

    // ---------- BUTTON HOOKUP (click + touch) ----------

    function bindStartButton(btn, setNumber) {
      btn.addEventListener("click", () => startGame(setNumber));
      btn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        startGame(setNumber);
      }, { passive: false });
    }

    bindStartButton(document.getElementById("start-set-1"), 1);
    bindStartButton(document.getElementById("start-set-2"), 2);

    document.getElementById("play-again-set1").addEventListener("click", () => startGame(1));
    document.getElementById("play-again-set2").addEventListener("click", () => startGame(2));

    document.getElementById("back-to-intro").addEventListener("click", () => {
      clearInterval(timerInterval);
      clearInterval(animationInterval);
      if (bgMusicEl) bgMusicEl.pause();
      gameRunning = false;
      introScreen.style.display = "block";
      gameScreen.style.display = "none";
    });
  </script>
</body>
</html>
