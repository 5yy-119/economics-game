<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The World‚Äôs Most ‚Äì Economics Flag Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #111827;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      max-width: 960px;
      width: 100%;
      padding: 16px;
    }

    h1, h2, h3 {
      margin: 0;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      margin-top: 8px;
      margin-bottom: 16px;
      color: #334155;
      font-size: 15px;
    }

    /* HERO / START PAGE */

    #intro-screen {
      display: block;
    }

    #game-screen {
      display: none;
    }

    .hero {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      margin-bottom: 16px;
      box-shadow: 0 8px 24px rgba(15,23,42,0.5);
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      background: url("images/start-page.jpeg") center/cover no-repeat;
      transform: scale(1.02);
    }

    .hero-overlay {
      position: relative;
      padding: 40px 20px;
      text-align: center;
      color: #fff;
      text-shadow: 0 2px 8px rgba(0,0,0,0.6);
      background: linear-gradient(180deg, rgba(0,0,0,0.1), rgba(0,0,0,0.55));
    }

    .hero-title {
      font-size: 40px;
      letter-spacing: 2px;
      margin-bottom: 6px;
    }

    .hero-subtitle {
      font-size: 16px;
      max-width: 520px;
      margin: 0 auto;
    }

    .btn-row {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 18px 0 22px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 26px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      background: #f97316;
      color: #fff;
      box-shadow: 0 6px 14px rgba(124,45,18,0.35);
      font-weight: 600;
      transition: transform 0.08s ease, box-shadow 0.1s ease, background 0.1s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(124,45,18,0.45);
      background: #ea580c;
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(124,45,18,0.45);
    }

    .btn-large {
      font-size: 18px;
      padding: 14px 34px;
    }

    .concepts {
      background: #f9fafb;
      border-radius: 16px;
      padding: 14px 18px;
      box-shadow: 0 4px 12px rgba(15,23,42,0.15);
      margin-bottom: 16px;
    }

    .concepts h3 {
      margin-top: 0;
      text-align: left;
      font-size: 18px;
    }

    .concepts ul {
      margin: 6px 0 0 16px;
      padding: 0;
      font-size: 14px;
      color: #111827;
    }

    .concepts li {
      margin-bottom: 4px;
    }

    .controls-hint {
      font-size: 13px;
      text-align: center;
      margin-top: 6px;
      color: #4b5563;
    }

    /* GAME SCREEN */

    .hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 14px;
      color: #111827;
    }

    .question-text {
      font-weight: 600;
      margin-bottom: 10px;
      min-height: 44px;
      font-size: 15px;
    }

    #game-area {
      position: relative;
      height: 380px;
      border-radius: 18px;
      background: url("images/background.jpeg") center/cover no-repeat;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(15,23,42,0.5);
      touch-action: none; /* smoother touch control */
    }

    .flag {
      position: absolute;
      top: -80px;
      width: 70px;
      height: 70px;
      pointer-events: none;
      user-select: none;
    }

    .flag img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 3px 6px rgba(15,23,42,0.4);
      background: #fff;
    }

    #basket {
      position: absolute;
      bottom: 12px;
      width: 90px;
      height: 55px;
      border-radius: 26px;
      background: linear-gradient(180deg,#f97316,#ea580c);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 30px;
      box-shadow: 0 4px 10px rgba(124,45,18,0.6);
      border: 2px solid rgba(255,255,255,0.6);
    }

    #options-legend {
      margin-top: 10px;
      font-size: 14px;
      background: #f9fafb;
      border-radius: 12px;
      padding: 8px 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .legend-item img {
      width: 20px;
      height: 20px;
      border-radius: 50%;
    }

    #message {
      margin-top: 10px;
      min-height: 34px;
      font-size: 14px;
    }

    .correct {
      color: #15803d;
    }

    .wrong {
      color: #b91c1c;
    }

    #result-screen {
      margin-top: 16px;
      padding: 16px 14px;
      border-radius: 14px;
      background: radial-gradient(circle at top, #bbf7d0, #ecfdf5);
      border: 1px solid #22c55e;
      display: none;
      font-size: 14px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    #result-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 4px;
      background: linear-gradient(90deg,#f97316,#ec4899,#22c55e,#0ea5e9);
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    #result-detail {
      display: block;
      margin-bottom: 6px;
      color: #065f46;
      font-weight: 500;
    }

    .gift {
      margin-top: 4px;
      font-weight: 700;
      color: #166534;
    }

    .confetti {
      position: absolute;
      width: 8px;
      height: 14px;
      background: #f97316;
      top: -20px;
      border-radius: 2px;
      opacity: 0.9;
      animation: fallConfetti 1.6s linear forwards;
    }

    @keyframes fallConfetti {
      to {
        transform: translateY(220px) rotate(260deg);
        opacity: 0;
      }
    }

    .hud-right {
      text-align: right;
    }

    @media (max-width: 720px) {
      #game-area {
        height: 330px;
      }
      .hero-title {
        font-size: 32px;
      }
      .hero-overlay {
        padding: 30px 16px;
      }
    }
  </style>
</head>
<body>
  <audio id="bg-music" src="background-music.mp3" loop></audio>

  <div class="container">
    <!-- INTRO SCREEN -->
    <div id="intro-screen">
      <div class="hero">
        <div class="hero-overlay">
          <div class="hero-title">THE WORLD‚ÄôS MOST</div>
          <div class="hero-subtitle">
            Guess which country is ‚Äúthe most‚Äù in different economic categories:
            GDP, cost of living, inequality, minimum wage and more!
          </div>
        </div>
      </div>

      <p class="subtitle">
        Use your finger (iPad) or mouse (computer) to move the basket and catch the correct flag.
        Get <strong>3 or more</strong> questions correct to win a small gift üéÅ!
      </p>

      <div class="concepts">
        <h3>Key Economic Concepts in This Game</h3>
        <ul>
          <li><strong>GDP (Gross Domestic Product)</strong>: Total value of goods and services produced in a country.</li>
          <li><strong>GDP per capita</strong>: GDP divided by population ‚Äì a rough measure of average income.</li>
          <li><strong>Income inequality (Gini coefficient)</strong>: How unevenly income is spread across people.</li>
          <li><strong>Cost of living</strong>: How expensive it is to buy everyday goods and services.</li>
          <li><strong>Unemployment rate</strong>: Percentage of workers who are jobless but looking for work.</li>
          <li><strong>Inflation</strong>: How quickly overall prices are rising.</li>
          <li><strong>Minimum wage</strong>: The lowest legal wage per hour/day set by law.</li>
          <li><strong>Big Mac Index</strong>: Compares the price of a Big Mac in different countries to show purchasing power.</li>
        </ul>
      </div>

      <h3 style="margin-top:10px;">Choose Your Question Set</h3>
      <p class="controls-hint">
        Each set has 6 questions. There is <strong>no time limit</strong>, just have fun learning Economics!
      </p>

      <div class="btn-row">
        <button class="btn-large" id="start-set-1">PLAY ‚Äì Set 1</button>
        <button class="btn-large" id="start-set-2">PLAY ‚Äì Set 2</button>
      </div>

      <p class="controls-hint">
        Controls: drag inside the game area with your <strong>finger</strong> (iPad) or <strong>mouse</strong> (computer)
        to move the basket. Arrow keys (‚Üê ‚Üí) also work.
      </p>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen">
      <div class="hud">
        <div id="question-counter">Question 1 / 6</div>
        <div class="hud-right" id="score-display">Correct: 0</div>
      </div>
      <div class="question-text" id="question-text"></div>

      <div id="game-area">
        <div id="basket">üß∫</div>
      </div>

      <div id="options-legend"></div>
      <div id="message"></div>

      <div id="result-screen">
        <div id="result-title">CONGRATULATIONS!</div>
        <span id="result-detail"></span>
        <div class="gift" id="gift-message"></div>
        <div class="btn-row" style="margin-top:12px; justify-content:center;">
          <button id="play-again-set1">Play Set 1 Again</button>
          <button id="play-again-set2">Play Set 2 Again</button>
          <button id="back-to-intro">Back to Start Page</button>
        </div>
      </div>

      <p class="controls-hint">
        Catch the <strong>correct</strong> flag for each question. One catch = one answer.
      </p>
    </div>
  </div>

  <script>
    // ------------ QUESTION DATA (PNG FLAGS) ------------

    // Helper: we will reference all images from /images/
    const imgPath = (file) => `images/${file}`;

    const SET1_QUESTIONS = [
      {
        id: 1,
        text: "Which country has the highest GDP in the world?",
        options: [
          { country: "China", img: "china.png" },
          { country: "Japan", img: "japan.png" },
          { country: "Germany", img: "germany.png" },
          { country: "United States", img: "united-states.png" } // correct
        ],
        correctIndex: 3,
        explanation: "The United States has the world‚Äôs largest economy in terms of nominal GDP."
      },
      {
        id: 3,
        text: "Which country is known for having one of the highest levels of income inequality?",
        options: [
          { country: "Brazil", img: "brazil.png" },
          { country: "South Africa", img: "south-africa.png" }, // correct
          { country: "Canada", img: "canada.png" },
          { country: "Norway", img: "norway.png" }
        ],
        correctIndex: 1,
        explanation: "South Africa‚Äôs Gini coefficient is among the highest, showing very unequal income distribution."
      },
      {
        id: 5,
        text: "Which country has the highest national debt as a percentage of GDP?",
        options: [
          { country: "United States", img: "usa.png" },
          { country: "Greece", img: "greece.png" },
          { country: "Japan", img: "japan.png" }, // correct
          { country: "Italy", img: "italy.png" }
        ],
        correctIndex: 2,
        explanation: "Japan‚Äôs public debt is more than twice its GDP, one of the highest ratios in the world."
      },
      {
        id: 7,
        text: "Which country has experienced one of the highest inflation rates in recent years?",
        options: [
          { country: "Brazil", img: "brazil.png" },
          { country: "Turkey", img: "turkey.png" },
          { country: "Venezuela", img: "venezuela.png" }, // correct
          { country: "Argentina", img: "argentina.png" }
        ],
        correctIndex: 2,
        explanation: "Venezuela has suffered from hyperinflation due to severe economic and political instability."
      },
      {
        id: 9,
        text: "Which country is known for having a very high youth unemployment rate among developed economies?",
        options: [
          { country: "Spain", img: "spain.png" },
          { country: "Italy", img: "italy.png" },
          { country: "France", img: "france.png" },
          { country: "Greece", img: "greece.png" } // correct
        ],
        correctIndex: 3,
        explanation: "Greece has recorded very high youth unemployment rates, especially after the debt crisis."
      },
      {
        id: 11,
        text: "According to the Big Mac Index, which country often has one of the highest Big Mac prices?",
        options: [
          { country: "Switzerland", img: "switzerland.png" }, // correct
          { country: "China", img: "china.png" },
          { country: "Indonesia", img: "indonesia.png" },
          { country: "Philippines", img: "philippines.png" }
        ],
        correctIndex: 0,
        explanation: "Switzerland usually has one of the most expensive Big Macs, showing a strong currency and high price level."
      }
    ];

    const SET2_QUESTIONS = [
      {
        id: 2,
        text: "Which country has the highest GDP per capita among the following?",
        options: [
          { country: "Norway", img: "norway.png" },
          { country: "Luxembourg", img: "luxembourg.png" }, // correct
          { country: "Switzerland", img: "switzerland.png" },
          { country: "Singapore", img: "singapore.png" }
        ],
        correctIndex: 1,
        explanation: "Luxembourg‚Äôs small population and strong financial sector give it very high GDP per person."
      },
      {
        id: 4,
        text: "Which country is famous for having one of the highest costs of living?",
        options: [
          { country: "Japan", img: "japan.png" },
          { country: "Australia", img: "australia.png" },
          { country: "Switzerland", img: "switzerland.png" }, // correct
          { country: "Canada", img: "canada.png" }
        ],
        correctIndex: 2,
        explanation: "Switzerland has very high prices for housing, food and services, making it one of the most expensive places to live."
      },
      {
        id: 6,
        text: "Which country has one of the lowest unemployment rates?",
        options: [
          { country: "Qatar", img: "qatar.png" }, // correct
          { country: "Germany", img: "germany.png" },
          { country: "Canada", img: "canada.png" },
          { country: "Switzerland", img: "switzerland.png" }
        ],
        correctIndex: 0,
        explanation: "Qatar‚Äôs labour market structure leads to extremely low measured unemployment."
      },
      {
        id: 8,
        text: "Which country has one of the largest trade surpluses?",
        options: [
          { country: "China", img: "china.png" }, // correct
          { country: "Japan", img: "japan.png" },
          { country: "Germany", img: "germany.png" },
          { country: "United States", img: "united-states.png" }
        ],
        correctIndex: 0,
        explanation: "China exports far more than it imports, producing a very large trade surplus."
      },
      {
        id: 13,
        text: "Which country has the highest number of billionaires?",
        options: [
          { country: "India", img: "india.png" },
          { country: "United States", img: "United-States.png" }, // correct
          { country: "Russia", img: "russia.png" },
          { country: "Germany", img: "germany.png" }
        ],
        correctIndex: 1,
        explanation: "The United States leads the world in number of billionaires, driven by tech, finance and other industries."
      },
      {
        id: 16,
        text: "Which country among the following has one of the lowest minimum wages (in HKD terms)?",
        options: [
          { country: "Australia", img: "australia.png" },
          { country: "United Kingdom", img: "united-kingdom.png" },
          { country: "Philippines", img: "philippines.png" }, // correct
          { country: "Hong Kong", img: "hong-kong.png" }
        ],
        correctIndex: 2,
        explanation: "The Philippines has a much lower statutory minimum wage than the other countries listed, when converted into HKD."
      }
    ];

    // ------------ DOM ELEMENTS ------------

    const introScreen = document.getElementById("intro-screen");
    const gameScreen = document.getElementById("game-screen");
    const questionTextEl = document.getElementById("question-text");
    const questionCounterEl = document.getElementById("question-counter");
    const scoreDisplayEl = document.getElementById("score-display");
    const gameArea = document.getElementById("game-area");
    const basket = document.getElementById("basket");
    const optionsLegendEl = document.getElementById("options-legend");
    const messageEl = document.getElementById("message");
    const resultScreen = document.getElementById("result-screen");
    const resultTitleEl = document.getElementById("result-title");
    const resultDetailEl = document.getElementById("result-detail");
    const giftMessageEl = document.getElementById("gift-message");
    const bgMusicEl = document.getElementById("bg-music");

    let currentQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let fallingFlags = [];
    let questionActive = false;
    let basketX = 0;
    let animationInterval = null;
    let dragging = false;
    let audioCtx = null;

    function initAudioContext() {
      if (!audioCtx) {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (AC) audioCtx = new AC();
      }
    }

    // ------------ GAME STATE ------------

    function resetGameState() {
      clearInterval(animationInterval);
      animationInterval = null;
      currentIndex = 0;
      score = 0;
      fallingFlags.forEach(f => {
        if (f.el && f.el.parentNode) f.el.parentNode.removeChild(f.el);
      });
      fallingFlags = [];
      questionActive = false;
      messageEl.textContent = "";
      optionsLegendEl.textContent = "";
      resultScreen.style.display = "none";
      updateScoreDisplay();
    }

    function startGame(setNumber) {
      resetGameState();
      currentQuestions = setNumber === 1 ? SET1_QUESTIONS : SET2_QUESTIONS;

      introScreen.style.display = "none";
      gameScreen.style.display = "block";

      // centre basket
      setTimeout(() => {
        const areaWidth = gameArea.clientWidth;
        basketX = (areaWidth - basket.offsetWidth) / 2;
        updateBasketPosition();
      }, 0);

      playBackgroundMusic();
      loadQuestion();
    }

    function updateScoreDisplay() {
      scoreDisplayEl.textContent = `Correct: ${score}`;
    }

    function loadQuestion() {
      clearInterval(animationInterval);
      animationInterval = null;

      fallingFlags.forEach(f => {
        if (f.el && f.el.parentNode) f.el.parentNode.removeChild(f.el);
      });
      fallingFlags = [];
      optionsLegendEl.textContent = "";
      messageEl.textContent = "";
      messageEl.className = "";

      if (currentIndex >= currentQuestions.length) {
        endGame();
        return;
      }

      const q = currentQuestions[currentIndex];
      questionActive = true;

      questionCounterEl.textContent = `Question ${currentIndex + 1} / ${currentQuestions.length}`;
      questionTextEl.textContent = q.text;

      // Legend
      q.options.forEach(opt => {
        const span = document.createElement("span");
        span.className = "legend-item";
        const img = document.createElement("img");
        img.src = imgPath(opt.img);
        img.alt = opt.country;
        span.appendChild(img);
        const text = document.createTextNode(" " + opt.country);
        span.appendChild(text);
        optionsLegendEl.appendChild(span);
      });

      // Create falling flags
      const areaWidth = gameArea.clientWidth;
      const areaHeight = gameArea.clientHeight;

      q.options.forEach((opt, index) => {
        const wrapper = document.createElement("div");
        wrapper.className = "flag";
        const img = document.createElement("img");
        img.src = imgPath(opt.img);
        img.alt = opt.country;
        wrapper.appendChild(img);
        gameArea.appendChild(wrapper);

        const flagWidth = 70;
        // Extra spacing between flags
        const x = Math.random() * (areaWidth - flagWidth - 30) + 15;
        const speed = 1 + Math.random() * 1.2;

        wrapper.style.left = x + "px";
        wrapper.style.top = "-80px";

        fallingFlags.push({
          el: wrapper,
          x,
          y: -80,
          speed,
          isCorrect: index === q.correctIndex,
          option: opt
        });
      });

      animationInterval = setInterval(() => {
        const areaHeightNow = gameArea.clientHeight;
        updateFlags(areaHeightNow);
      }, 30);
    }

    function updateFlags(areaHeight) {
      if (!questionActive) return;

      const basketRect = basket.getBoundingClientRect();

      fallingFlags.forEach(flag => {
        flag.y += flag.speed;
        flag.el.style.top = flag.y + "px";

        const flagRect = flag.el.getBoundingClientRect();
        if (isIntersecting(basketRect, flagRect) && questionActive) {
          handleFlagCaught(flag);
        }
      });

      // Remove flags that fall out
      fallingFlags = fallingFlags.filter(flag => {
        if (flag.y > areaHeight + 20) {
          if (flag.el && flag.el.parentNode) flag.el.parentNode.removeChild(flag.el);
          return false;
        }
        return true;
      });

      // If all flags gone and still active -> move on
      if (fallingFlags.length === 0 && questionActive) {
        questionActive = false;
        messageEl.textContent = "The flags disappeared! No answer for this question.";
        messageEl.className = "wrong";
        setTimeout(() => {
          currentIndex++;
          loadQuestion();
        }, 2200);
      }
    }

    function isIntersecting(r1, r2) {
      return !(
        r1.right < r2.left ||
        r1.left > r2.right ||
        r1.bottom < r2.top ||
        r1.top > r2.bottom
      );
    }

    function handleFlagCaught(flag) {
      questionActive = false;
      clearInterval(animationInterval);
      animationInterval = null;

      const q = currentQuestions[currentIndex];
      const correctOption = q.options[q.correctIndex];

      if (flag.isCorrect) {
        score++;
        updateScoreDisplay();
        messageEl.textContent = "‚úÖ Correct! " + q.explanation;
        messageEl.className = "correct";
        playAnswerSound(true);
      } else {
        messageEl.textContent =
          `‚ùå Not quite. The correct flag was ${correctOption.country}. ` + q.explanation;
        messageEl.className = "wrong";
        playAnswerSound(false);
      }

      // remove remaining flags
      setTimeout(() => {
        fallingFlags.forEach(f => {
          if (f.el && f.el.parentNode) f.el.parentNode.removeChild(f.el);
        });
        fallingFlags = [];
      }, 300);

      // give students a few seconds to read the explanation
      setTimeout(() => {
        currentIndex++;
        loadQuestion();
      }, 2600);
    }

    function endGame() {
      questionActive = false;
      clearInterval(animationInterval);
      animationInterval = null;

      resultScreen.style.display = "block";
      if (score >= 3) {
        resultTitleEl.textContent = "CONGRATULATIONS!";
        resultDetailEl.textContent = `You answered ${score} out of ${currentQuestions.length} questions correctly.`;
        giftMessageEl.textContent = "üéÅ You win a small gift! Please collect it from the booth staff.";
        playApplause();
        launchConfetti();
      } else {
        resultTitleEl.textContent = "Good Try!";
        resultDetailEl.textContent = `You answered ${score} out of ${currentQuestions.length} questions correctly.`;
        giftMessageEl.textContent = "Keep trying! Get 3 or more correct next time to win a gift.";
      }
    }

    // ------------ BASKET MOVEMENT ------------

    function updateBasketPosition() {
      const areaWidth = gameArea.clientWidth;
      const maxX = areaWidth - basket.offsetWidth - 4;
      if (basketX < 4) basketX = 4;
      if (basketX > maxX) basketX = maxX;
      basket.style.left = basketX + "px";
    }

    function moveBasketToClientX(clientX) {
      const rect = gameArea.getBoundingClientRect();
      const relativeX = clientX - rect.left;
      basketX = relativeX - basket.offsetWidth / 2;
      updateBasketPosition();
    }

    // Keyboard backup
    window.addEventListener("keydown", (e) => {
      const step = 26;
      if (e.key === "ArrowLeft" || e.key === "a" || e.key === "A") {
        basketX -= step;
        updateBasketPosition();
      } else if (e.key === "ArrowRight" || e.key === "d" || e.key === "D") {
        basketX += step;
        updateBasketPosition();
      }
    });

    // Mouse controls
    gameArea.addEventListener("mousedown", (e) => {
      dragging = true;
      moveBasketToClientX(e.clientX);
    });

    window.addEventListener("mouseup", () => {
      dragging = false;
    });

    gameArea.addEventListener("mousemove", (e) => {
      if (dragging) {
        moveBasketToClientX(e.clientX);
      }
    });

    // Touch controls (iPad)
    gameArea.addEventListener("touchstart", (e) => {
      dragging = true;
      const touch = e.touches[0];
      moveBasketToClientX(touch.clientX);
      e.preventDefault();
    }, { passive: false });

    gameArea.addEventListener("touchmove", (e) => {
      if (!dragging) return;
      const touch = e.touches[0];
      moveBasketToClientX(touch.clientX);
      e.preventDefault();
    }, { passive: false });

    window.addEventListener("touchend", () => {
      dragging = false;
    });

    // ------------ SOUND ------------

    function playBackgroundMusic() {
      if (!bgMusicEl) return;
      bgMusicEl.volume = 0.45;
      const p = bgMusicEl.play();
      if (p && p.catch) {
        p.catch(() => {
          // autoplay might be blocked; ignore
        });
      }
    }

    function stopBackgroundMusic() {
      if (!bgMusicEl) return;
      bgMusicEl.pause();
      bgMusicEl.currentTime = 0;
    }

    function playAnswerSound(isCorrect) {
      initAudioContext();
      if (!audioCtx) return;

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      if (isCorrect) {
        osc.type = "triangle";
        osc.frequency.setValueAtTime(880, audioCtx.currentTime);
      } else {
        osc.type = "sawtooth";
        osc.frequency.setValueAtTime(220, audioCtx.currentTime);
      }

      gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.25);

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start();
      osc.stop(audioCtx.currentTime + 0.28);
    }

    function playApplause() {
      initAudioContext();
      if (!audioCtx) return;

      // Simple "applause-like" burst using noise
      const bufferSize = audioCtx.sampleRate * 0.7;
      const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
      }
      const noise = audioCtx.createBufferSource();
      noise.buffer = buffer;

      const gain = audioCtx.createGain();
      gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.7);

      noise.connect(gain);
      gain.connect(audioCtx.destination);

      noise.start();
      noise.stop(audioCtx.currentTime + 0.7);
    }

    // ------------ CONFETTI ------------

    function launchConfetti() {
      const count = 80;
      for (let i = 0; i < count; i++) {
        const c = document.createElement("div");
        c.className = "confetti";
        const colors = ["#f97316","#22c55e","#0ea5e9","#e11d48","#a855f7","#facc15"];
        c.style.background = colors[Math.floor(Math.random()*colors.length)];
        c.style.left = Math.random() * 100 + "%";
        c.style.animationDelay = (Math.random()*0.4) + "s";
        c.style.transform = `translateY(0) rotate(${Math.random()*180}deg)`;
        resultScreen.appendChild(c);
        setTimeout(() => {
          if (c.parentNode) c.parentNode.removeChild(c);
        }, 2000);
      }
    }

    // ------------ BUTTON EVENTS ------------

    document.getElementById("start-set-1").addEventListener("click", () => {
      startGame(1);
    });

    document.getElementById("start-set-2").addEventListener("click", () => {
      startGame(2);
    });

    document.getElementById("play-again-set1").addEventListener("click", () => {
      startGame(1);
    });

    document.getElementById("play-again-set2").addEventListener("click", () => {
      startGame(2);
    });

    document.getElementById("back-to-intro").addEventListener("click", () => {
      clearInterval(animationInterval);
      animationInterval = null;
      stopBackgroundMusic();
      introScreen.style.display = "block";
      gameScreen.style.display = "none";
    });
  </script>
</body>
</html>
