<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The World‚Äôs Most ‚Äì Economics Flag Game</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111827;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      color: #f9fafb;
    }

    .container {
      max-width: 1000px;
      width: 100%;
      padding: 16px;
    }

    h1 {
      text-align: center;
      margin: 8px 0 0;
      font-size: 38px;
      letter-spacing: 1px;
    }

    .subtitle {
      text-align: center;
      margin-top: 4px;
      margin-bottom: 12px;
      color: #e5e7eb;
      font-size: 14px;
    }

    .concepts {
      background: #020617;
      border-radius: 18px;
      padding: 16px 20px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.6);
      margin-bottom: 16px;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .concepts h3 {
      margin: 0 0 6px;
      font-size: 18px;
    }

    .concepts ul {
      margin: 6px 0 0 18px;
      padding: 0;
      font-size: 14px;
    }

    .concepts li {
      margin-bottom: 3px;
    }

    .btn-row {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 14px 0 20px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 22px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      background: linear-gradient(135deg, #f97316, #facc15);
      color: #111827;
      font-weight: 700;
      box-shadow: 0 6px 18px rgba(234, 179, 8, 0.5);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }

    button:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 10px 22px rgba(234, 179, 8, 0.7);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 3px 10px rgba(234, 179, 8, 0.7);
    }

    #big-play {
      font-size: 22px;
      padding: 16px 40px;
    }

    .controls-hint {
      font-size: 12px;
      text-align: center;
      margin-top: 4px;
      color: #cbd5f5;
    }

    #intro-screen {
      display: block;
    }

    #game-screen {
      display: none;
    }

    .hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 15px;
    }

    #question-counter {
      font-weight: 600;
    }

    #score-display {
      font-weight: 600;
      color: #bbf7d0;
    }

    .question-text {
      font-weight: 600;
      margin-bottom: 10px;
      min-height: 42px;
      font-size: 16px;
    }

    /* GAME AREA ‚Äì scaled up 1.5x */
    #game-area {
      position: relative;
      height: 540px; /* was ~360 */
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 10px 35px rgba(0, 0, 0, 0.7);
      border: 2px solid rgba(148, 163, 184, 0.7);
      background-image: url("image/background.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .flag {
      position: absolute;
      top: -120px;
      width: 96px;   /* bigger flags */
      height: 96px;
      pointer-events: none;
      user-select: none;
    }

    #basket {
      position: absolute;
      bottom: 20px;
      width: 140px;   /* bigger basket */
      height: 80px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 42px;
      color: #fbbf24;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.9);
      border: 2px solid rgba(251, 191, 36, 0.8);
    }

    #options-legend {
      margin-top: 10px;
      font-size: 14px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 14px;
      padding: 8px 10px;
      color: #e5e7eb;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    #options-legend span {
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    #options-legend img {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 1px solid rgba(148, 163, 184, 0.7);
    }

    #message {
      margin-top: 10px;
      min-height: 32px;
      font-size: 14px;
    }

    .correct {
      color: #bbf7d0;
    }

    .wrong {
      color: #fecaca;
    }

    #result-screen {
      margin-top: 16px;
      padding: 14px 16px;
      border-radius: 16px;
      background: radial-gradient(circle at top, #4ade80, #16a34a);
      border: 2px solid #bbf7d0;
      display: none;
      color: #052e16;
    }

    #result-title {
      font-size: 26px;
      font-weight: 900;
      text-align: center;
      margin-bottom: 4px;
      letter-spacing: 1px;
      text-shadow: 0 0 6px rgba(255, 255, 255, 0.65);
    }

    #result-detail {
      display: block;
      text-align: center;
      margin-bottom: 4px;
      font-weight: 600;
    }

    #gift-message {
      text-align: center;
      font-weight: 700;
      font-size: 16px;
    }

    .sparkles {
      position: relative;
      text-align: center;
      margin-bottom: 6px;
      font-size: 20px;
    }

    .sparkles span {
      display: inline-block;
      margin: 0 3px;
      animation: float 1.2s ease-in-out infinite alternate;
    }

    .sparkles span:nth-child(2) {
      animation-delay: 0.2s;
    }
    .sparkles span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes float {
      from { transform: translateY(0); }
      to { transform: translateY(-6px); }
    }

    .result-buttons {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    @media (max-width: 800px) {
      h1 {
        font-size: 30px;
      }
      #game-area {
        height: 480px;
      }
      #basket {
        width: 130px;
        height: 76px;
      }
      .flag {
        width: 88px;
        height: 88px;
      }
    }

    /* Hide audio controls */
    audio {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>The World‚Äôs Most</h1>
    <p class="subtitle">
      Move the basket to catch the correct country‚Äôs flag and learn Economics! üß∫üåç
    </p>

    <!-- Hidden audio element for background music -->
    <audio id="bg-music" src="background-music.mp3" loop></audio>

    <!-- INTRO / CONCEPTS SCREEN -->
    <div id="intro-screen">
      <div class="concepts">
        <h3>Key Economic Concepts in This Game</h3>
        <ul>
          <li><strong>GDP (Gross Domestic Product)</strong> ‚Äì total value of goods and services produced in a country.</li>
          <li><strong>GDP per capita</strong> ‚Äì GDP divided by population, a rough measure of average income.</li>
          <li><strong>Income inequality (Gini coefficient)</strong> ‚Äì how unevenly income is shared.</li>
          <li><strong>Cost of living</strong> ‚Äì how expensive daily life is (housing, food, transport, etc.).</li>
          <li><strong>National debt (% of GDP)</strong> ‚Äì how much a government owes compared with the size of its economy.</li>
          <li><strong>Trade surplus</strong> ‚Äì when a country‚Äôs exports are greater than its imports.</li>
          <li><strong>FDI (Foreign Direct Investment)</strong> ‚Äì investment from foreign companies into a country.</li>
          <li><strong>Minimum wage</strong> ‚Äì the lowest legal wage employers must pay workers.</li>
          <li><strong>Big Mac Index</strong> ‚Äì compares the price of a Big Mac in different countries to show price levels and purchasing power.</li>
        </ul>
      </div>

      <h3 style="text-align:center; margin-bottom:6px;">Choose Your Question Set</h3>
      <p class="controls-hint">
        Each set has 6 questions. Get <strong>3 or more correct</strong> and you are a winner! üéâ
      </p>

      <div class="btn-row">
        <button id="start-set-1">Play Set 1</button>
        <button id="start-set-2">Play Set 2</button>
      </div>

      <div style="text-align:center; margin-top:10px;">
        <button id="big-play">‚ñ∂ PLAY (Random Set)</button>
      </div>

      <p class="controls-hint">
        Controls: Drag with your finger (iPad / touch) or move the mouse on top of the basket (desktop).
      </p>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen">
      <div class="hud">
        <div id="question-counter">Question 1 / 6</div>
        <div id="score-display">Correct: 0</div>
      </div>
      <div class="question-text" id="question-text"></div>

      <div id="game-area">
        <div id="basket">üß∫</div>
      </div>

      <div id="options-legend"></div>
      <div id="message"></div>

      <div id="result-screen">
        <div class="sparkles">
          <span>‚ú®</span><span>üåç</span><span>‚ú®</span>
        </div>
        <div id="result-title">CONGRATULATIONS!</div>
        <span id="result-detail"></span>
        <div id="gift-message"></div>
        <div class="result-buttons">
          <button id="play-again-set1">Play Set 1 Again</button>
          <button id="play-again-set2">Play Set 2 Again</button>
          <button id="back-to-intro">Back to Concepts</button>
        </div>
      </div>

      <p class="controls-hint">
        Catch only the correct flag for each question. Watch carefully before you move! üëÄ
      </p>
    </div>
  </div>

  <script>
    // ---------------- QUESTION DATA (only using countries you have PNGs for) ----------------

    // helper to build options easily
    function opt(country, file) {
      return { country, file };
    }

    const SET1_QUESTIONS = [
      {
        text: "Which country has the highest GDP in the world (nominal GDP)?",
        options: [
          opt("China", "china.png"),
          opt("Germany", "germany.png"),
          opt("Japan", "japan.png"),
          opt("United States", "usa.png") // correct
        ],
        correctIndex: 3,
        explanation: "The United States has the world‚Äôs largest economy in terms of nominal GDP."
      },
      {
        text: "Which country has one of the highest GDPs per capita?",
        options: [
          opt("Norway", "norway.png"),
          opt("Luxembourg", "luxembourg.png"), // correct
          opt("Australia", "australia.png"),
          opt("Canada", "canada.png")
        ],
        correctIndex: 1,
        explanation: "Luxembourg‚Äôs small population and strong financial sector give it very high GDP per person."
      },
      {
        text: "Which country is famous for having one of the highest costs of living?",
        options: [
          opt("France", "france.png"),
          opt("Japan", "japan.png"),
          opt("Switzerland", "switzerland.png"), // correct
          opt("Hong Kong", "hong-kong.png")
        ],
        correctIndex: 2,
        explanation: "Switzerland is known for very high prices of housing, food and services."
      },
      {
        text: "Which country has one of the largest trade surpluses in the world?",
        options: [
          opt("China", "china.png"), // correct
          opt("United States", "usa.png"),
          opt("Australia", "australia.png"),
          opt("Indonesia", "indonesia.png")
        ],
        correctIndex: 0,
        explanation: "China exports much more than it imports, creating a large trade surplus."
      },
      {
        text: "Which country has the highest number of billionaires?",
        options: [
          opt("Germany", "germany.png"),
          opt("China", "china.png"),
          opt("United States", "usa.png"), // correct
          opt("Japan", "japan.png")
        ],
        correctIndex: 2,
        explanation: "The United States leads the world in the number of billionaires."
      },
      {
        text: "Which country among the following has one of the lowest minimum wages (in HKD terms)?",
        options: [
          opt("Australia", "australia.png"),
          opt("Norway", "norway.png"),
          opt("Philippines", "philippines.png"), // correct
          opt("Hong Kong", "hong-kong.png")
        ],
        correctIndex: 2,
        explanation: "The Philippines has a much lower minimum wage than the other countries listed when converted into HKD."
      }
    ];

    const SET2_QUESTIONS = [
      {
        text: "Which country has one of the highest national debts as a percentage of GDP?",
        options: [
          opt("United States", "usa.png"),
          opt("France", "france.png"),
          opt("Japan", "japan.png"), // correct
          opt("Italy", "italy.png")
        ],
        correctIndex: 2,
        explanation: "Japan‚Äôs government debt is more than twice its GDP, one of the highest ratios in the world."
      },
      {
        text: "Which country is known for having very high youth unemployment (among European countries)?",
        options: [
          opt("Germany", "germany.png"),
          opt("Greece", "greece.png"), // correct
          opt("France", "france.png"),
          opt("Norway", "norway.png")
        ],
        correctIndex: 1,
        explanation: "Greece has faced very high unemployment, especially among young people."
      },
      {
        text: "Which country is known for high income inequality (large gap between rich and poor)?",
        options: [
          opt("Brazil", "brazil.png"), // correct
          opt("Canada", "canada.png"),
          opt("Norway", "norway.png"),
          opt("Japan", "japan.png")
        ],
        correctIndex: 0,
        explanation: "Brazil has a high Gini coefficient, showing significant income inequality."
      },
      {
        text: "Which country has one of the lowest unemployment rates in the world?",
        options: [
          opt("Qatar", "qatar.png"), // correct
          opt("United States", "usa.png"),
          opt("Singapore", "singapore.png"),
          opt("Germany", "germany.png")
        ],
        correctIndex: 0,
        explanation: "Qatar‚Äôs labour market has extremely low measured unemployment."
      },
      {
        text: "Which country often receives the largest amount of foreign direct investment (FDI)?",
        options: [
          opt("China", "china.png"),
          opt("Singapore", "singapore.png"),
          opt("United Kingdom", "united-kingdom.png"),
          opt("United States", "usa.png") // correct
        ],
        correctIndex: 3,
        explanation: "The United States is a major destination for foreign investment due to its large, stable economy."
      },
      {
        text: "According to the Big Mac Index, which country often has one of the most expensive Big Macs?",
        options: [
          opt("United States", "usa.png"),
          opt("United Kingdom", "united-kingdom.png"),
          opt("Japan", "japan.png"),
          opt("Switzerland", "switzerland.png") // correct
        ],
        correctIndex: 3,
        explanation: "Switzerland usually has very expensive Big Macs, reflecting its strong currency and high price level."
      }
    ];

    // ---------------- GAME STATE ----------------

    const introScreen = document.getElementById("intro-screen");
    const gameScreen = document.getElementById("game-screen");
    const questionTextEl = document.getElementById("question-text");
    const questionCounterEl = document.getElementById("question-counter");
    const scoreDisplayEl = document.getElementById("score-display");
    const gameArea = document.getElementById("game-area");
    const basket = document.getElementById("basket");
    const optionsLegendEl = document.getElementById("options-legend");
    const messageEl = document.getElementById("message");
    const resultScreen = document.getElementById("result-screen");
    const resultTitleEl = document.getElementById("result-title");
    const resultDetailEl = document.getElementById("result-detail");
    const giftMessageEl = document.getElementById("gift-message");
    const bgMusic = document.getElementById("bg-music");

    let currentQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let fallingFlags = [];
    let questionActive = false;
    let animationInterval = null;
    let basketX = 0;
    let audioCtx = null;

    function resetGameState() {
      clearInterval(animationInterval);
      animationInterval = null;
      currentIndex = 0;
      score = 0;
      fallingFlags = [];
      questionActive = false;
      messageEl.textContent = "";
      messageEl.className = "";
      optionsLegendEl.innerHTML = "";
      resultScreen.style.display = "none";
      updateScoreDisplay();
      // remove any leftover flags
      const oldFlags = gameArea.querySelectorAll(".flag");
      oldFlags.forEach(f => f.remove());
    }

    function startGame(setNumber) {
      resetGameState();
      currentQuestions = setNumber === 1 ? SET1_QUESTIONS : SET2_QUESTIONS;

      introScreen.style.display = "none";
      gameScreen.style.display = "block";

      // place basket in center
      requestAnimationFrame(() => {
        const areaWidth = gameArea.clientWidth;
        basketX = (areaWidth - basket.offsetWidth) / 2;
        updateBasketPosition();
      });

      // start background music after user click/touch (required on iPad)
      try {
        bgMusic.play().catch(() => {});
      } catch (e) {}

      loadQuestion();
    }

    function updateScoreDisplay() {
      scoreDisplayEl.textContent = `Correct: ${score}`;
    }

    function loadQuestion() {
      clearInterval(animationInterval);
      animationInterval = null;

      // remove old flags
      fallingFlags.forEach(f => f.el.remove());
      fallingFlags = [];
      optionsLegendEl.innerHTML = "";
      messageEl.textContent = "";
      messageEl.className = "";

      if (currentIndex >= currentQuestions.length) {
        endGame();
        return;
      }

      const q = currentQuestions[currentIndex];
      questionActive = true;

      questionCounterEl.textContent = `Question ${currentIndex + 1} / ${currentQuestions.length}`;
      questionTextEl.textContent = q.text;

      // show legend
      q.options.forEach(opt => {
        const span = document.createElement("span");
        const img = document.createElement("img");
        img.src = "image/" + opt.file;
        img.alt = opt.country;
        span.appendChild(img);
        const text = document.createTextNode(" " + opt.country);
        span.appendChild(text);
        optionsLegendEl.appendChild(span);
      });

      // create falling flags
      const areaWidth = gameArea.clientWidth;
      const areaHeight = gameArea.clientHeight;
      const usedX = [];

      q.options.forEach((opt, index) => {
        const img = document.createElement("img");
        img.className = "flag";
        img.src = "image/" + opt.file;
        img.alt = opt.country;
        gameArea.appendChild(img);

        // choose x with minimum distance between flags
        let x;
        const minDistance = 140;
        let attempts = 0;
        do {
          x = 20 + Math.random() * (areaWidth - 120);
          attempts++;
          if (attempts > 20) break;
        } while (usedX.some(prevX => Math.abs(prevX - x) < minDistance));
        usedX.push(x);

        const speed = 1.0 + Math.random() * 1.0; // slower fall

        img.style.left = x + "px";
        img.style.top = "-120px";

        fallingFlags.push({
          el: img,
          x,
          y: -120,
          speed,
          isCorrect: index === q.correctIndex,
          option: opt
        });
      });

      animationInterval = setInterval(() => {
        updateFlags(areaHeight);
      }, 30);
    }

    function updateFlags(areaHeight) {
      if (!questionActive) return;

      const basketRect = basket.getBoundingClientRect();

      fallingFlags.forEach(flag => {
        flag.y += flag.speed;
        flag.el.style.top = flag.y + "px";

        const flagRect = flag.el.getBoundingClientRect();
        if (isIntersecting(basketRect, flagRect) && questionActive) {
          handleFlagCaught(flag);
        }
      });

      // remove flags that fell off
      fallingFlags = fallingFlags.filter(flag => {
        if (flag.y > areaHeight + 150) {
          flag.el.remove();
          return false;
        }
        return true;
      });

      if (fallingFlags.length === 0 && questionActive) {
        // no flag caught ‚Äì move to next question
        questionActive = false;
        const q = currentQuestions[currentIndex];
        const correctOpt = q.options[q.correctIndex];
        messageEl.textContent =
          `Time for this question is over. The correct flag was ${correctOpt.country}. ` + q.explanation;
        messageEl.className = "wrong";
        playIncorrectSound();
        setTimeout(() => {
          currentIndex++;
          loadQuestion();
        }, 2600); // give students more time to read
      }
    }

    function isIntersecting(r1, r2) {
      return !(
        r1.right < r2.left ||
        r1.left > r2.right ||
        r1.bottom < r2.top ||
        r1.top > r2.bottom
      );
    }

    function handleFlagCaught(flag) {
      questionActive = false;
      clearInterval(animationInterval);
      animationInterval = null;

      const q = currentQuestions[currentIndex];
      const correctOption = q.options[q.correctIndex];

      if (flag.isCorrect) {
        score++;
        updateScoreDisplay();
        messageEl.textContent = "‚úÖ Correct! " + q.explanation;
        messageEl.className = "correct";
        playCorrectSound();
      } else {
        messageEl.textContent =
          `‚ùå Not quite. The correct flag was ${correctOption.country}. ` + q.explanation;
        messageEl.className = "wrong";
        playIncorrectSound();
      }

      setTimeout(() => {
        fallingFlags.forEach(f => f.el.remove());
        fallingFlags = [];
        currentIndex++;
        loadQuestion();
      }, 2600); // extra time to read the explanation
    }

    function endGame() {
      questionActive = false;
      clearInterval(animationInterval);
      animationInterval = null;

      resultScreen.style.display = "block";

      if (score >= 3) {
        resultTitleEl.textContent = "üéâ CONGRATULATIONS! üéâ";
        giftMessageEl.textContent = "You answered enough questions correctly ‚Äì you are a WINNER!";
        playCelebrationSound();
      } else {
        resultTitleEl.textContent = "Good Try!";
        giftMessageEl.textContent = "Keep practising ‚Äì try again to get 3 or more correct.";
      }

      resultDetailEl.textContent = `You answered ${score} out of ${currentQuestions.length} questions correctly.`;
    }

    // ---------------- BASKET MOVEMENT (mouse + touch) ----------------

    function updateBasketPosition() {
      const areaWidth = gameArea.clientWidth;
      const maxX = areaWidth - basket.offsetWidth - 6;
      if (basketX < 6) basketX = 6;
      if (basketX > maxX) basketX = maxX;
      basket.style.left = basketX + "px";
    }

    // mouse move over game area
    gameArea.addEventListener("mousemove", (e) => {
      const rect = gameArea.getBoundingClientRect();
      const x = e.clientX - rect.left;
      basketX = x - basket.offsetWidth / 2;
      updateBasketPosition();
    });

    // touch controls for iPad / phones
    gameArea.addEventListener("touchstart", handleTouch, { passive: false });
    gameArea.addEventListener("touchmove", handleTouch, { passive: false });

    function handleTouch(e) {
      e.preventDefault();
      if (!e.touches || e.touches.length === 0) return;
      const touch = e.touches[0];
      const rect = gameArea.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      basketX = x - basket.offsetWidth / 2;
      updateBasketPosition();
    }

    // ---------------- SOUND EFFECTS ----------------

    function ensureAudioContext() {
      if (!audioCtx) {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (!AC) return null;
        audioCtx = new AC();
      }
      return audioCtx;
    }

    function playTone(freq, duration, type = "sine") {
      const ctx = ensureAudioContext();
      if (!ctx) return;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = type;
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(0.25, ctx.currentTime);
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start();
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
      osc.stop(ctx.currentTime + duration + 0.02);
    }

    function playCorrectSound() {
      playTone(900, 0.18, "triangle");
      setTimeout(() => playTone(1200, 0.18, "triangle"), 120);
    }

    function playIncorrectSound() {
      playTone(200, 0.25, "sawtooth");
    }

    function playCelebrationSound() {
      playTone(880, 0.2, "square");
      setTimeout(() => playTone(1175, 0.2, "square"), 200);
      setTimeout(() => playTone(1568, 0.25, "square"), 380);
    }

    // ---------------- BUTTON HOOKUP ----------------

    document.getElementById("start-set-1").addEventListener("click", () => startGame(1));
    document.getElementById("start-set-2").addEventListener("click", () => startGame(2));
    document.getElementById("big-play").addEventListener("click", () => {
      const randomSet = Math.random() < 0.5 ? 1 : 2;
      startGame(randomSet);
    });

    document.getElementById("play-again-set1").addEventListener("click", () => startGame(1));
    document.getElementById("play-again-set2").addEventListener("click", () => startGame(2));
    document.getElementById("back-to-intro").addEventListener("click", () => {
      clearInterval(animationInterval);
      animationInterval = null;
      introScreen.style.display = "block";
      gameScreen.style.display = "none";
      // stop music when going back
      try {
        bgMusic.pause();
        bgMusic.currentTime = 0;
      } catch (e) {}
    });
  </script>
</body>
</html>
