<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The Worldâ€™s Most â€“ Economics Flag Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Comic Sans MS", "Baloo 2", system-ui, -apple-system,
        BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #000;
      overflow: hidden;
    }

    .screen {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      display: none;
    }

    /* START PAGE */
    #start-screen {
      display: flex; /* shown first */
      background: url("images/start-page.png") center center / cover no-repeat;
      cursor: pointer;
    }

    /* INSTRUCTION PAGE */
    #instruction-screen {
      background: url("images/instruction.png") center center / cover no-repeat;
      cursor: pointer;
    }

    /* GAME SCREEN */
    #game-screen {
      display: none;
      background: url("images/background.png") center center / cover no-repeat;
      color: #fff;
      padding: 16px;
      display: none;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
    }

    .hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 20px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
      margin-bottom: 8px;
    }

    #question-text {
      font-size: 26px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 8px;
      padding: 4px 10px;
      text-shadow: 0 3px 6px rgba(0, 0, 0, 0.7);
    }

    #game-area {
      position: relative;
      flex: 1;
      margin-top: 8px;
      border-radius: 20px;
      overflow: hidden;
      /* transparent so background image shows through */
    }

    /* FALLING FLAGS */
    .flag {
      position: absolute;
      top: -150px;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      pointer-events: none;
      user-select: none;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    }

    /* BASKET */
    #basket {
      position: absolute;
      bottom: 16px;
      width: 170px;
      height: 90px;
      border-radius: 999px;
      background: rgba(255, 140, 0, 0.92);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 56px;
      color: #fff;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.6);
    }

    #options-legend {
      margin-top: 8px;
      font-size: 14px;
      background: rgba(0, 0, 0, 0.55);
      border-radius: 14px;
      padding: 8px 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    #options-legend span {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.09);
      white-space: nowrap;
    }

    .legend-flag {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 4px;
    }

    #message {
      margin-top: 6px;
      min-height: 32px;
      font-size: 16px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
    }

    .correct {
      color: #bbff99;
    }

    .wrong {
      color: #ffd1d1;
    }

    #result-screen {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #ffe45c;
      display: none;
      font-size: 18px;
      text-align: center;
    }

    #result-title {
      font-size: 28px;
      font-weight: 900;
      margin-bottom: 4px;
      color: #ffe45c;
      text-shadow: 0 3px 8px rgba(0, 0, 0, 0.8);
    }

    .gift {
      margin-top: 6px;
      font-weight: 700;
      color: #c4ffb3;
    }

    .btn-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      background: #ff9f1c;
      color: #222;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      transition: transform 0.07s ease, box-shadow 0.07s ease,
        background 0.1s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.6);
      background: #ffb648;
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.7);
    }

    .controls-hint {
      font-size: 12px;
      text-align: center;
      margin-top: 4px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
    }

    @media (max-width: 700px) {
      #question-text {
        font-size: 22px;
      }
      #basket {
        width: 150px;
        height: 80px;
        font-size: 50px;
      }
      .flag {
        width: 110px;
        height: 110px;
      }
    }
  </style>
</head>
<body>
  <!-- SCREENS -->
  <div id="start-screen" class="screen"></div>

  <div id="instruction-screen" class="screen"></div>

  <div id="game-screen" class="screen">
    <div class="hud">
      <div id="question-counter">Question 1 / 8</div>
      <div id="score-display">Correct: 0</div>
    </div>

    <div id="question-text"></div>

    <div id="game-area">
      <div id="basket">ðŸ§º</div>
    </div>

    <div id="options-legend"></div>
    <div id="message"></div>

    <div id="result-screen">
      <div id="result-title"></div>
      <div id="result-detail"></div>
      <div class="gift" id="gift-message"></div>
      <div class="btn-row">
        <button id="play-again">Play Again</button>
        <button id="back-to-start">Back to Start</button>
      </div>
    </div>

    <p class="controls-hint">
      Move the basket by dragging with your finger (iPad) or mouse (desktop) and
      catch the correct flag!
    </p>
  </div>

  <script>
    // ----------------- QUESTION DATA (8 QUESTIONS) -----------------
    const QUESTIONS = [
      {
        id: 1,
        text: "Which country has the highest GDP in the world?",
        options: [
          { country: "China", image: "china.png" },
          { country: "Japan", image: "japan.png" },
          { country: "Germany", image: "germany.png" },
          { country: "United States", image: "united-states.png" } // correct
        ],
        correctIndex: 3,
        explanation:
          "The United States has the worldâ€™s largest economy in terms of nominal GDP."
      },
      {
        id: 2,
        text: "Which country has the highest GDP per capita?",
        options: [
          { country: "Norway", image: "norway.png" },
          { country: "Luxembourg", image: "luxembourg.png" }, // correct
          { country: "Switzerland", image: "switzerland.png" },
          { country: "Singapore", image: "singapore.png" }
        ],
        correctIndex: 1,
        explanation:
          "Luxembourgâ€™s small population and strong financial sector give it very high GDP per person."
      },
      {
        id: 3,
        text:
          "Which country has the highest level of income inequality among the following?",
        options: [
          { country: "Brazil", image: "brazil.png" }, // correct
          { country: "Germany", image: "germany.png" },
          { country: "Norway", image: "norway.png" },
          { country: "Japan", image: "japan.png" }
        ],
        correctIndex: 0,
        explanation:
          "Brazil is well known for having a high level of income inequality compared with other countries listed."
      },
      {
        id: 5,
        text: "Which country has the highest national debt as a percentage of GDP?",
        options: [
          { country: "United States", image: "united-states.png" },
          { country: "Greece", image: "greece.png" },
          { country: "Japan", image: "japan.png" }, // correct
          { country: "Italy", image: "italy.png" }
        ],
        correctIndex: 2,
        explanation:
          "Japanâ€™s public debt is more than twice its GDP, one of the highest ratios in the world."
      },
      {
        id: 6,
        text: "Which country has one of the lowest unemployment rates?",
        options: [
          { country: "Qatar", image: "qatar.png" }, // correct
          { country: "Germany", image: "germany.png" },
          { country: "Canada", image: "canada.png" },
          { country: "Switzerland", image: "switzerland.png" }
        ],
        correctIndex: 0,
        explanation:
          "Qatarâ€™s labour market structure leads to extremely low measured unemployment."
      },
      {
        id: 11,
        text:
          "According to the Big Mac Index, which country often has one of the highest Big Mac prices?",
        options: [
          { country: "Switzerland", image: "switzerland.png" }, // correct
          { country: "China", image: "china.png" },
          { country: "Indonesia", image: "indonesia.png" },
          { country: "Hong Kong", image: "hong-kong.png" }
        ],
        correctIndex: 0,
        explanation:
          "Switzerland usually has one of the most expensive Big Macs, showing a strong currency and high price level."
      },
      {
        id: 13,
        text: "Which country has the highest number of billionaires?",
        options: [
          { country: "China", image: "china.png" },
          { country: "United States", image: "united-states.png" }, // correct
          { country: "Germany", image: "germany.png" },
          { country: "United Kingdom", image: "united-kingdom.png" }
        ],
        correctIndex: 1,
        explanation:
          "The United States leads the world in number of billionaires, driven by tech, finance and other industries."
      },
      {
        id: 16,
        text:
          "Which country among the following has one of the lowest minimum wages (in HKD terms)?",
        options: [
          { country: "Australia", image: "australia.png" },
          { country: "United Kingdom", image: "united-kingdom.png" },
          { country: "Philippines", image: "philippines.png" }, // correct
          { country: "United States", image: "united-states.png" }
        ],
        correctIndex: 2,
        explanation:
          "The Philippines has a much lower statutory minimum wage than the other countries listed when converted into HKD."
      }
    ];

    // ----------------- ELEMENTS -----------------
    const startScreen = document.getElementById("start-screen");
    const instructionScreen = document.getElementById("instruction-screen");
    const gameScreen = document.getElementById("game-screen");

    const questionCounterEl = document.getElementById("question-counter");
    const scoreDisplayEl = document.getElementById("score-display");
    const questionTextEl = document.getElementById("question-text");
    const gameArea = document.getElementById("game-area");
    const basket = document.getElementById("basket");
    const optionsLegendEl = document.getElementById("options-legend");
    const messageEl = document.getElementById("message");
    const resultScreen = document.getElementById("result-screen");
    const resultTitleEl = document.getElementById("result-title");
    const resultDetailEl = document.getElementById("result-detail");
    const giftMessageEl = document.getElementById("gift-message");
    const playAgainBtn = document.getElementById("play-again");
    const backToStartBtn = document.getElementById("back-to-start");

    // ----------------- GAME STATE -----------------
    let currentIndex = 0;
    let score = 0;
    let fallingFlags = [];
    let animationInterval = null;
    let questionActive = false;
    let basketX = 0;

    // ----------------- HELPERS -----------------
    function resetGame() {
      clearInterval(animationInterval);
      animationInterval = null;
      currentIndex = 0;
      score = 0;
      fallingFlags.forEach((f) => {
        if (f.el && f.el.parentNode) f.el.parentNode.removeChild(f.el);
      });
      fallingFlags = [];
      messageEl.textContent = "";
      messageEl.className = "";
      resultScreen.style.display = "none";
      updateScoreDisplay();
      setTimeout(centerBasket, 50);
    }

    function updateScoreDisplay() {
      scoreDisplayEl.textContent = `Correct: ${score}`;
    }

    function centerBasket() {
      const areaWidth = gameArea.clientWidth;
      basketX = (areaWidth - basket.offsetWidth) / 2;
      updateBasketPosition();
    }

    function updateBasketPosition() {
      const areaWidth = gameArea.clientWidth;
      const maxX = areaWidth - basket.offsetWidth - 4;
      if (basketX < 4) basketX = 4;
      if (basketX > maxX) basketX = maxX;
      basket.style.left = basketX + "px";
    }

    function loadQuestion() {
      clearInterval(animationInterval);
      animationInterval = null;

      fallingFlags.forEach((f) => {
        if (f.el && f.el.parentNode) f.el.parentNode.removeChild(f.el);
      });
      fallingFlags = [];
      messageEl.textContent = "";
      messageEl.className = "";
      optionsLegendEl.innerHTML = "";

      if (currentIndex >= QUESTIONS.length) {
        endGame();
        return;
      }

      const q = QUESTIONS[currentIndex];
      questionActive = true;

      questionCounterEl.textContent = `Question ${currentIndex + 1} / ${
        QUESTIONS.length
      }`;
      questionTextEl.textContent = q.text;

      // Legend / footnotes
      q.options.forEach((opt) => {
        const span = document.createElement("span");
        const img = document.createElement("img");
        img.src = "images/" + opt.image;
        img.className = "legend-flag";
        span.appendChild(img);
        const label = document.createElement("span");
        label.textContent = " " + opt.country;
        span.appendChild(label);
        optionsLegendEl.appendChild(span);
      });

      const areaWidth = gameArea.clientWidth;
      const areaHeight = gameArea.clientHeight;

      // Create falling flags
      q.options.forEach((opt, index) => {
        const img = document.createElement("img");
        img.className = "flag";
        img.src = "images/" + opt.image;
        gameArea.appendChild(img);

        const flagWidth = 120;
        const x =
          Math.random() * (areaWidth - flagWidth - 40) + 20 + index * 5; // slight spread
        const speed = 1 + Math.random() * 1.3;

        img.style.left = x + "px";
        img.style.top = "-150px";

        fallingFlags.push({
          el: img,
          x,
          y: -150,
          speed,
          isCorrect: index === q.correctIndex,
          option: opt
        });
      });

      animationInterval = setInterval(() => {
        updateFlags(areaHeight);
      }, 30);
    }

    function isIntersecting(rect1, rect2) {
      return !(
        rect1.right < rect2.left ||
        rect1.left > rect2.right ||
        rect1.bottom < rect2.top ||
        rect1.top > rect2.bottom
      );
    }

    function updateFlags(areaHeight) {
      if (!questionActive) return;

      const basketRect = basket.getBoundingClientRect();

      fallingFlags.forEach((flag) => {
        flag.y += flag.speed;
        flag.el.style.top = flag.y + "px";

        const flagRect = flag.el.getBoundingClientRect();
        if (isIntersecting(basketRect, flagRect) && questionActive) {
          handleFlagCaught(flag);
        }
      });

      fallingFlags = fallingFlags.filter((flag) => {
        if (flag.y > areaHeight + 200) {
          if (flag.el && flag.el.parentNode) {
            flag.el.parentNode.removeChild(flag.el);
          }
          return false;
        }
        return true;
      });

      if (fallingFlags.length === 0 && questionActive) {
        questionActive = false;
        const q = QUESTIONS[currentIndex];
        const correctOption = q.options[q.correctIndex];
        messageEl.textContent =
          "â³ Timeâ€™s up for this question. The correct flag was " +
          correctOption.country +
          ". " +
          q.explanation;
        messageEl.className = "wrong";
        setTimeout(() => {
          currentIndex++;
          loadQuestion();
        }, 2200);
      }
    }

    function handleFlagCaught(flag) {
      if (!questionActive) return;
      questionActive = false;
      clearInterval(animationInterval);
      animationInterval = null;

      setTimeout(() => {
        fallingFlags.forEach((f) => {
          if (f.el && f.el.parentNode) f.el.parentNode.removeChild(f.el);
        });
        fallingFlags = [];
      }, 150);

      const q = QUESTIONS[currentIndex];
      const correctOption = q.options[q.correctIndex];

      if (flag.isCorrect) {
        score++;
        updateScoreDisplay();
        messageEl.textContent = "âœ… Correct! " + q.explanation;
        messageEl.className = "correct";
      } else {
        messageEl.textContent =
          "âŒ Not quite. The correct flag was " +
          correctOption.country +
          ". " +
          q.explanation;
        messageEl.className = "wrong";
      }

      setTimeout(() => {
        currentIndex++;
        loadQuestion();
      }, 2600); // a few seconds so students can read
    }

    function endGame() {
      questionActive = false;
      clearInterval(animationInterval);
      animationInterval = null;

      resultScreen.style.display = "block";
      resultTitleEl.textContent = "CONGRATULATIONS!";
      resultDetailEl.textContent = `You answered ${score} out of ${
        QUESTIONS.length
      } questions correctly.`;

      if (score >= 3) {
        giftMessageEl.textContent =
          "ðŸŽ You win a small gift! Please collect it from the booth!";
      } else {
        giftMessageEl.textContent =
          "Keep trying! Get 3 or more correct next time to win a gift.";
      }
    }

    // ----------------- CONTROLS: MOUSE + TOUCH -----------------
    function handlePointerMove(evt) {
      const rect = gameArea.getBoundingClientRect();
      let clientX;
      if (evt.touches && evt.touches.length > 0) {
        clientX = evt.touches[0].clientX;
      } else {
        clientX = evt.clientX;
      }
      basketX = clientX - rect.left - basket.offsetWidth / 2;
      updateBasketPosition();
    }

    gameArea.addEventListener("mousemove", handlePointerMove);
    gameArea.addEventListener(
      "touchstart",
      (e) => {
        e.preventDefault();
        handlePointerMove(e);
      },
      { passive: false }
    );
    gameArea.addEventListener(
      "touchmove",
      (e) => {
        e.preventDefault();
        handlePointerMove(e);
      },
      { passive: false }
    );

    window.addEventListener("resize", centerBasket);

    // ----------------- SCREEN TRANSITIONS -----------------
    startScreen.addEventListener("click", () => {
      startScreen.style.display = "none";
      instructionScreen.style.display = "block";
    });

    instructionScreen.addEventListener("click", () => {
      instructionScreen.style.display = "none";
      gameScreen.style.display = "flex";
      resetGame();
      loadQuestion();
    });

    playAgainBtn.addEventListener("click", () => {
      resetGame();
      loadQuestion();
    });

    backToStartBtn.addEventListener("click", () => {
      gameScreen.style.display = "none";
      resultScreen.style.display = "none";
      startScreen.style.display = "block";
    });

    // Initial center basket once layout is ready
    window.addEventListener("load", () => {
      centerBasket();
    });
  </script>
</body>
</html>
